---
title: "FACTORS THAT AFFECT DIABETES"
author: "Nikolaos Tzouras"
date: "10/9/2025"
output:
  html_document: null
  pdf_document: default
---
  <style>
  body, p, h1, h2, h3, h4, h5, h6, li {
    font-family: "Times New Roman", Times, serif;
  }
h1, h2, h3 {
  font-weight: bold;
  text-align: center;
}
h1 { font-size: 32px; }
h2 { font-size: 28px; }
h3 { font-size: 24px; }
code { font-family: Consolas, monospace; }
</style>


---
  
## 1. Introduction
  
Diabetes is a chronic disease that occurs either when the pancreas does not produce enough insulin or when the body cannot effectively use the insulin it produces.Diabetes is recognized as a significant factor in both mortality and morbidity worldwide, affecting various demographics.

This project aims in exploring the way **demographics and clinical factors** (such as Age,Gender,Body Mass Index - BMI,Smoking Status and Cholesterol) are associated with the presence of diabetes in the population.

**Research Question:**
  *How do demographic and clinical predictors influence the likelihood of having diabetes?*
  
---
  
## 2. Data and Methodology
  For the analysis, we extracted the data from the **NHANES** (National Health and Nutrition Examination Survey), which is a nationally representative survey of the United States population that includes demographic, clinical and biochemical measurements.

We selected the following variables out of the dataset:
- **Diabetes** (Yes/No) → Target variable (Outcome)
- **Age** (Years)
- **Gender** (Male/Female)
- **BMI** (Body Mass Index)
- **SmokeNow** (Current Smoking Status)
- **TotChol** (Total Cholesterol)


Missing values where handled as follows:
- Observations with NA for both **Diabetes** and **BMI** variables were completely removed.
- Missing values for the categorical variable **SmokeNow** were instead replaced with the value **"Unknown"** thus creating a third categorical value.

Our data set now holds 9629 observations while Cholesterol has a 12.7%  NA observation values. So, it was deemed necessary to conduct two separate analysis, i.e. a sensitivity analysis. The main analysis will be conducted without the cholesterol variable, and the secondary will include cholesterol where the NA values were recorded as the sample median.

---
  
## 3. Results
  
  
### 3.1 Descriptive Analysis 
  Looking at the **Age** and **BMI** histograms, clearly there are massive differences between diabetic and non-diabetic individuals. 
- Diabetic participants tend to be older and also have higher BMI on average than non-diabetics.


On the secondary analysis, that includes the **Total Cholesterol**, the distribution plot does not suggest any strong separation between the two groups. 

Both analysis, result in the same conclusion as per the percentages of diabetic people on both **Smoking Status** and **Gender**, regardless the addition of the cholesterol. Those graphs indicate only modest differences, with a slightly higher percentage of diabetics currently Smoking and no differences at all from the **Gender** point of view. Results on a much bigger sample might have given stronger separation for the **Smoking Status** of the participants.

The descriptive statistics show that diabetic individuals tend to be older (59.1 ± 14.7 vs 35.9 ± 21.3) and have higher **BMI** (32.6 ± 8.2 vs 26.2 ± 7.1) compared to non-diabetics, while Total Cholesterol levels are similar between the two groups (4.8 ± 1.1 vs 4.9 ± 1.1).


### 3.2 Inferential Statistics
t-tests were conducted to evaluate differences in means between diabetic and non-diabetic groups. A p-value below 0.05 indicates a statistically significant difference between diabetic and non-diabetic groups.

- **Age** is significantly higher among diabetic individuals (*p-value*<0.001).
- **BMI** is significantly higher among diabetic individuals (*p-value*<0.001).
- **TotChol** shows a weaker association with diabetes compared to **Age** and **BMI**,although the difference between diabetics and non-diabetics is statistically significant. (*p-value*=0.035)


### 3.3 Logistic Regression Models
Two logistic regression models were fitted:
  
- **Model 1 (Without TotChol)**:
**Age** and **BMI** are strong positive predictors of diabetes. **Gender** and **Smoking status** contribute, but with smaller effect sizes.

- **Model 2 (With TotChol)**:
Including **Cholesterol** does not change coefficients or any other predictors meaningfully. **Cholesterol** itself is not a strong independent predictor of diabetes.


Model comparison using *AIC*,*AnOVa* and *likelihood ratio testing* suggests that **adding cholesterol does not meaningfully improve model fit**.

Both logistic regression models confirm that **Age** and **BMI** are the strongest predictors of diabetes, with each one-year increase in age raising the odds by ~5.9% and each one-unit increase in BMI raising the odds by ~10%. Male gender has a moderate positive effect, whereas smoking status shows small, non-significant effects relative to the reference category 'No'. In model 2, adding **TotChol** shows a statistically significant association (OR=0.74, 95% CI: 0.68-0.81), indicating slightly lower odds of diabetes with higher cholesterol levels, although its practical effect is minimal. These findings are consistent with the confidence intervals, AIC, and likelihood ratio test results, suggesting that including cholesterol does not meaningfully improve model fit.




### 3.4 ROC Analysis
ROC curves were generated for both models:
- **Model 1** (Without cholesterol) achieved an AUC of about *[0.843]*.
- **Model 2** (With cholesterol) achieved an AUC of about *[0.847]*.

Both models demonstrate good discrimination (AUC>0.8), and the minimal increase from adding cholesterol confirms its limited practical contribution to predictive accuracy.

The curves overlap substantially, and the AUC values differ only a tiny amount, confirming that the inclusion of cholesterol provides only a little gain in predictive performance, as said previously.


---

## 4. Conclusion
In conclusion, this study/project demonstrates that **Age** and **BMI** are key predictors of diabetes, while **Gender** and **Smoking Status** have smaller, non-significant effects. Including **Total Cholesterol** provides little additional predictive value, despite its statistical significance.

Future research could explore additional clinical and lifestyle factors, such as diet, physical activity or genetic markers, to better understand diabetes risk and improve predictive models.

Overall, the findings emphasize the relevance of **Age** and **BMI** in assessing diabetes risk in population-based datasets, while highlighting the limitations of cross-sectional analysis in establishing causality.

Limitations of this study include the cross-sectional nature of the **NHANES**, which prevents causal inference. Finally, other potential confounders, such as physical activity or diet, were not included in this analysis and could potentially influence the associations observed.



---



## Code / Outputs 

```{r setup, message=FALSE, warning=FALSE}
#install.packages("NHANES")
library(NHANES)
library(ggplot2)
library(dplyr)
library(tidyr)
library(scales)
library(gridExtra)
library(pROC)
library(grid)
library(knitr)


data<-NHANES
myvars<-c("Diabetes","Age","Gender","BMI","SmokeNow","TotChol")
new_data<-data[,myvars]

# NA observations for Diabetes and BMI are removed 
new_data<-new_data[!is.na(new_data$Diabetes) & !is.na(new_data$BMI),]

# Categorical variable SmokeNow: NA -> "Unknown"
new_data$SmokeNow<-as.character(new_data$SmokeNow)
new_data$SmokeNow[is.na(new_data$SmokeNow)]<-"Unknown"
new_data$SmokeNow<-factor(new_data$SmokeNow)

# Datasets creation
data_no_chol<-new_data[,!(names(new_data) %in% "TotChol")]
data_chol<-new_data
median_chol<-median(data_chol$TotChol,na.rm=TRUE)
data_chol$TotChol[is.na(data_chol$TotChol)]<-median_chol
# Continuous variables
data_long_nochol<-pivot_longer(data_no_chol[,c("Diabetes","Age","BMI")],
                                 cols=c("Age","BMI"),
                                 names_to="Variable",
                                 values_to="Value")

data_long_chol<-pivot_longer(data_chol[,c("Diabetes","Age","BMI","TotChol")],
                               cols=c("Age","BMI","TotChol"),
                               names_to="Variable",
                               values_to="Value")

# Categorical variable: SmokeNow
data_prop_nochol1<-data_no_chol %>%
  group_by(SmokeNow,Diabetes) %>%
  summarise(n=n(),.groups="drop") %>%
  group_by(SmokeNow) %>%
  mutate(prop=n/sum(n))

data_prop_chol1<-data_chol %>%
  group_by(SmokeNow,Diabetes) %>%
  summarise(n=n(),.groups="drop") %>%
  group_by(SmokeNow) %>%
  mutate(prop=n/sum(n))
kable(data.frame(data_prop_nochol1$SmokeNow,data_prop_nochol1$Diabetes,data_prop_nochol1$n,data_prop_nochol1$prop), 
      col.names=c("SmokeNow","Diabetes","n","Prop"))

# Categorical variable: Gender
data_prop_nochol2<-data_no_chol %>%
  group_by(Gender,Diabetes) %>%
  summarise(n=n(),.groups="drop") %>%
  group_by(Gender) %>%
  mutate(prop=n/sum(n))
kable(data.frame(data_prop_nochol2$Gender,data_prop_nochol2$Diabetes,data_prop_nochol2$n,data_prop_nochol2$prop), 
      col.names=c("Gender","Diabetes","n","Prop"))

data_prop_chol2<-data_chol %>%
  group_by(Gender,Diabetes) %>%
  summarise(n=n(),.groups="drop") %>%
  group_by(Gender) %>%
  mutate(prop=n/sum(n))


# Continuous variables
p1_nochol<-ggplot(data_long_nochol,aes(x=Value,fill=Diabetes)) +
  geom_histogram(position="dodge",bins=30,color="black") +
  facet_wrap(~Variable,scales="free_x") +
  labs(title="Age,BMI Distribution (No TotChol)") 
p1_nochol<-p1_nochol+theme(
  plot.title=element_text(size=15,face="bold",hjust=0.5)
)  

p1_chol<-ggplot(data_long_chol,aes(x=Value,fill=Diabetes)) +
  geom_histogram(position="dodge",bins=30,color="black") +
  facet_wrap(~Variable,scales="free_x") +
  labs(title="Age,BMI,TotChol Distribution") 
p1_chol<-p1_chol+theme(
  plot.title=element_text(size=15,face="bold",hjust=0.5)
)   

# Categorical variables
p2_nochol<-ggplot(data_prop_nochol1,aes(x=SmokeNow,y=prop,fill=Diabetes)) +
  geom_bar(stat="identity") +
  geom_text(aes(label=scales::percent(prop,accuracy=1)),
            position=position_stack(vjust=0.5)) +
  scale_y_continuous(labels=percent_format()) +
  labs(title="diabetes % VS smoking (No TotChol)",y="Percentage") 
p2_nochol<-p2_nochol+theme(
  plot.title=element_text(size=15,face="bold",hjust=0.5)
)

p2_chol<-ggplot(data_prop_chol1,aes(x=SmokeNow,y=prop,fill=Diabetes)) +
  geom_bar(stat = "identity") +
  geom_text(aes(label=scales::percent(prop,accuracy=1)),
            position=position_stack(vjust=0.5)) +
  scale_y_continuous(labels=percent_format()) +
  labs(title="diabetes % VS smoking (With TotChol)",y="Percentage") 
p2_chol<-p2_chol+theme(
  plot.title=element_text(size=15,face="bold",hjust=0.5)
)

p3_nochol<-ggplot(data_prop_nochol2,aes(x=Gender,y=prop,fill=Diabetes)) +
  geom_bar(stat="identity") +
  geom_text(aes(label=scales::percent(prop,accuracy=1)),
            position=position_stack(vjust=0.5)) +
  scale_y_continuous(labels=percent_format()) +
  labs(title="Diabetes % Vs Gender (No TotChol)",y="Percentage") 
p3_nochol<-p3_nochol+theme(
  plot.title=element_text(size=15,face="bold",hjust=0.5)
)

p3_chol<-ggplot(data_prop_chol2,aes(x=Gender,y=prop,fill=Diabetes)) +
  geom_bar(stat="identity") +
  geom_text(aes(label=scales::percent(prop,accuracy=1)),
            position=position_stack(vjust=0.5)) +
  scale_y_continuous(labels=percent_format()) +
  labs(title="Diabetes % Vs Gender (With TotChol)",y="Percentage") 
p3_chol<-p3_chol+theme(
  plot.title=element_text(size=15,face="bold",hjust=0.5)
)

```{r distribution_plots,fig.width=15,fig.height=6,message=FALSE,warning=FALSE}


#Distribution plots together 
grid.arrange(p1_nochol,p1_chol,ncol=2)


#Categorical variables plots combination
grid.arrange(p2_nochol,p2_chol,ncol=1)
grid.arrange(p3_nochol,p3_chol,ncol=1)

# Continuous variables summary by Diabetes
summary_table<-new_data %>%
  group_by(Diabetes) %>%
  summarise(
    Age_mean=mean(Age,na.rm=TRUE),
    Age_sd=sd(Age,na.rm=TRUE),
    BMI_mean=mean(BMI,na.rm=TRUE),
    BMI_sd=sd(BMI,na.rm=TRUE),
    TotChol_mean=mean(TotChol,na.rm=TRUE),
    TotChol_sd=sd(TotChol,na.rm=TRUE)
  ) %>%
  mutate(
    Age=paste0(round(Age_mean,1)," ± ",round(Age_sd,1)),
    BMI=paste0(round(BMI_mean,1)," ± ",round(BMI_sd,1)),
    TotChol=paste0(round(TotChol_mean,1)," ± ",round(TotChol_sd,1))
  ) %>%
  select(Diabetes,Age,BMI,TotChol)

# Print nicely
kable(summary_table,col.names=c("Diabetes","Age(Mean ± SD)","BMI(Mean ± SD)","TotChol(Mean ± SD)"))




#Model withotu TotChol
model1<-glm(Diabetes~Age+Gender+BMI+SmokeNow,
              data=data_no_chol,family=binomial)

#Model with TotChol
model2<-glm(Diabetes~Age+Gender+BMI+SmokeNow+TotChol,
              data=data_chol,family=binomial)

#Coefficient comparison 
exp(coef(model1))
exp(coef(model2))
confint(model1)
confint(model2)

#Goodness-of-fit comparison
AIC(model1)
AIC(model2)

# Likelihood ratio test
anova(model1,model2,test="Chisq")
# Προβλέψεις πιθανοτήτων
pred1<-predict(model1,type="response")
pred2<-predict(model2,type="response")

# ROC curves
roc1<-roc(data_no_chol$Diabetes,pred1)
roc2<-roc(data_chol$Diabetes,pred2)

# AUC
auc1<-auc(roc1)
auc2<-auc(roc2)

print(paste("AUC without TotChol:",round(auc1,3)))
print(paste("AUC with TotChol:",round(auc2,3)))





t1<-t.test(Age~Diabetes,data=data_chol)
kable(data.frame(t1$statistic,t1$p.value),
      col.names=c("t-statistic","p-value"))
t2 <-t.test(BMI ~ Diabetes, data = data_chol)
kable(data.frame(t2$statistic, t2$p.value), 
      col.names = c("t-statistic","p-value"))
t3<-t.test(TotChol~Diabetes,data=data_chol)
kable(data.frame(t3$statistic,t3$p.value), 
      col.names=c("t-statistic","p-value"))



# ROC plot as ggplot object to be inserted in grid.arrange
roc_df1<-data.frame(
  fpr=1-roc1$specificities,
  tpr=roc1$sensitivities,
  Model="Without TotChol"
)

roc_df2<-data.frame(
  fpr=1-roc2$specificities,
  tpr=roc2$sensitivities,
  Model="With TotChol"
)

roc_df<-rbind(roc_df1,roc_df2)

p_roc<-ggplot(roc_df,aes(x=fpr,y=tpr,color=Model))+
  geom_line(size=1.2)+
  geom_abline(slope=1,intercept=0,linetype="dashed")+
  labs(x="1-Specificity",y="Sensitivity") +
  scale_color_manual(values=c("blue","red")) 




# ROC plot 
grid.arrange(p_roc,ncol=1,heights=c(5),top=textGrob("ROC Curves: Model Comparison",gp=gpar(fontsize=16,fontface="bold"))
)